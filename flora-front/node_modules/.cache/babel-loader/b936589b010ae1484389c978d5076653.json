{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _common = require(\"./common\");\n\nvar _config = require(\"./config\");\n/** ******************************************************************************\n *  (c) 2019 ZondaX GmbH\n *  (c) 2016-2017 Ledger\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n ******************************************************************************* */\n\n\nvar bip39 = require('bip39');\n\nvar hash = require('hash.js');\n\nvar bip32ed25519 = require('bip32-ed25519');\n\nvar bs58 = require('bs58');\n\nvar blake = require('blakejs');\n\nvar HDPATH_0_DEFAULT = 0x8000002c;\nvar INS = {\n  GET_VERSION: 0x00,\n  GET_ADDR: 0x01,\n  SIGN: 0x02,\n  // Allow list related commands\n  ALLOWLIST_GET_PUBKEY: 0x90,\n  ALLOWLIST_SET_PUBKEY: 0x91,\n  ALLOWLIST_GET_HASH: 0x92,\n  ALLOWLIST_UPLOAD: 0x93\n};\n\nvar SubstrateApp = /*#__PURE__*/function () {\n  function SubstrateApp(transport, cla, slip0044) {\n    (0, _classCallCheck2.default)(this, SubstrateApp);\n\n    if (!transport) {\n      throw new Error('Transport has not been defined');\n    }\n\n    this.transport = transport;\n    this.cla = cla;\n    this.slip0044 = slip0044;\n  }\n\n  (0, _createClass2.default)(SubstrateApp, [{\n    key: \"getVersion\",\n    value: function () {\n      var _getVersion2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {\n        return _regenerator.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return (0, _common.getVersion)(this.transport, this.cla);\n\n              case 3:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 6:\n                _context.prev = 6;\n                _context.t0 = _context[\"catch\"](0);\n                return _context.abrupt(\"return\", (0, _common.processErrorResponse)(_context.t0));\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 6]]);\n      }));\n\n      function getVersion() {\n        return _getVersion2.apply(this, arguments);\n      }\n\n      return getVersion;\n    }()\n  }, {\n    key: \"appInfo\",\n    value: function () {\n      var _appInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2() {\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", this.transport.send(0xb0, 0x01, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var result = {};\n                  var appName = 'err';\n                  var appVersion = 'err';\n                  var flagLen = 0;\n                  var flagsValue = 0;\n\n                  if (response[0] !== 1) {\n                    // Ledger responds with format ID 1. There is no spec for any format != 1\n                    result.error_message = 'response format ID not recognized';\n                    result.return_code = 0x9001;\n                  } else {\n                    var appNameLen = response[1];\n                    appName = response.slice(2, 2 + appNameLen).toString('ascii');\n                    var idx = 2 + appNameLen;\n                    var appVersionLen = response[idx];\n                    idx += 1;\n                    appVersion = response.slice(idx, idx + appVersionLen).toString('ascii');\n                    idx += appVersionLen;\n                    var appFlagsLen = response[idx];\n                    idx += 1;\n                    flagLen = appFlagsLen;\n                    flagsValue = response[idx];\n                  }\n\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    appName: appName,\n                    appVersion: appVersion,\n                    flagLen: flagLen,\n                    flagsValue: flagsValue,\n                    // eslint-disable-next-line no-bitwise\n                    flag_recovery: (flagsValue & 1) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_signed_mcu_code: (flagsValue & 2) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_onboarded: (flagsValue & 4) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_pin_validated: (flagsValue & 128) !== 0\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function appInfo() {\n        return _appInfo.apply(this, arguments);\n      }\n\n      return appInfo;\n    }()\n  }, {\n    key: \"getAddress\",\n    value: function () {\n      var _getAddress = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3(account, change, addressIndex) {\n        var requireConfirmation,\n            scheme,\n            bip44Path,\n            p1,\n            p2,\n            _args3 = arguments;\n        return _regenerator.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                requireConfirmation = _args3.length > 3 && _args3[3] !== undefined ? _args3[3] : false;\n                scheme = _args3.length > 4 && _args3[4] !== undefined ? _args3[4] : _common.SCHEME.ED25519;\n                bip44Path = SubstrateApp.serializePath(this.slip0044, account, change, addressIndex);\n                p1 = 0;\n                if (requireConfirmation) p1 = 1;\n                p2 = 0;\n                if (!isNaN(scheme)) p2 = scheme;\n                return _context3.abrupt(\"return\", this.transport.send(this.cla, INS.GET_ADDR, p1, p2, bip44Path).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var errorCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  return {\n                    pubKey: response.slice(0, 32).toString('hex'),\n                    address: response.slice(32, response.length - 2).toString('ascii'),\n                    return_code: errorCode,\n                    error_message: (0, _common.errorCodeToString)(errorCode)\n                  };\n                }, _common.processErrorResponse));\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getAddress(_x, _x2, _x3) {\n        return _getAddress.apply(this, arguments);\n      }\n\n      return getAddress;\n    }()\n  }, {\n    key: \"signSendChunk\",\n    value: function () {\n      var _signSendChunk = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4(chunkIdx, chunkNum, chunk) {\n        var scheme,\n            payloadType,\n            p2,\n            _args4 = arguments;\n        return _regenerator.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                scheme = _args4.length > 3 && _args4[3] !== undefined ? _args4[3] : _common.SCHEME.ED25519;\n                payloadType = _common.PAYLOAD_TYPE.ADD;\n\n                if (chunkIdx === 1) {\n                  payloadType = _common.PAYLOAD_TYPE.INIT;\n                }\n\n                if (chunkIdx === chunkNum) {\n                  payloadType = _common.PAYLOAD_TYPE.LAST;\n                }\n\n                p2 = 0;\n                if (!isNaN(scheme)) p2 = scheme;\n                return _context4.abrupt(\"return\", this.transport.send(this.cla, INS.SIGN, payloadType, p2, chunk, [_common.ERROR_CODE.NoError, 0x6984, 0x6a80]).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var errorMessage = (0, _common.errorCodeToString)(returnCode);\n                  var signature = null;\n\n                  if (returnCode === 0x6a80 || returnCode === 0x6984) {\n                    errorMessage = response.slice(0, response.length - 2).toString('ascii');\n                  } else if (response.length > 2) {\n                    signature = response.slice(0, response.length - 2);\n                  }\n\n                  return {\n                    signature: signature,\n                    return_code: returnCode,\n                    error_message: errorMessage\n                  };\n                }, _common.processErrorResponse));\n\n              case 7:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function signSendChunk(_x4, _x5, _x6) {\n        return _signSendChunk.apply(this, arguments);\n      }\n\n      return signSendChunk;\n    }()\n  }, {\n    key: \"sign\",\n    value: function () {\n      var _sign = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6(account, change, addressIndex, message) {\n        var _this = this;\n\n        var scheme,\n            chunks,\n            _args6 = arguments;\n        return _regenerator.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                scheme = _args6.length > 4 && _args6[4] !== undefined ? _args6[4] : _common.SCHEME.ED25519;\n                chunks = SubstrateApp.signGetChunks(this.slip0044, account, change, addressIndex, message);\n                return _context6.abrupt(\"return\", this.signSendChunk(1, chunks.length, chunks[0], scheme).then( /*#__PURE__*/function () {\n                  var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5(result) {\n                    var i;\n                    return _regenerator.default.wrap(function _callee5$(_context5) {\n                      while (1) {\n                        switch (_context5.prev = _context5.next) {\n                          case 0:\n                            i = 1;\n\n                          case 1:\n                            if (!(i < chunks.length)) {\n                              _context5.next = 10;\n                              break;\n                            }\n\n                            _context5.next = 4;\n                            return _this.signSendChunk(1 + i, chunks.length, chunks[i], scheme);\n\n                          case 4:\n                            result = _context5.sent;\n\n                            if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                              _context5.next = 7;\n                              break;\n                            }\n\n                            return _context5.abrupt(\"break\", 10);\n\n                          case 7:\n                            i += 1;\n                            _context5.next = 1;\n                            break;\n\n                          case 10:\n                            return _context5.abrupt(\"return\", {\n                              return_code: result.return_code,\n                              error_message: result.error_message,\n                              signature: result.signature\n                            });\n\n                          case 11:\n                          case \"end\":\n                            return _context5.stop();\n                        }\n                      }\n                    }, _callee5);\n                  }));\n\n                  return function (_x11) {\n                    return _ref.apply(this, arguments);\n                  };\n                }(), _common.processErrorResponse));\n\n              case 3:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function sign(_x7, _x8, _x9, _x10) {\n        return _sign.apply(this, arguments);\n      }\n\n      return sign;\n    }() /// Allow list related commands. They are NOT available on all apps\n\n  }, {\n    key: \"getAllowlistPubKey\",\n    value: function () {\n      var _getAllowlistPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee7() {\n        return _regenerator.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                return _context7.abrupt(\"return\", this.transport.send(this.cla, INS.ALLOWLIST_GET_PUBKEY, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  console.log(response);\n                  var pubkey = response.slice(0, 32); // 32 bytes + 2 error code\n                  // 32 bytes + 2 error code\n\n                  if (response.length !== 34) {\n                    return {\n                      return_code: 0x6984,\n                      error_message: (0, _common.errorCodeToString)(0x6984)\n                    };\n                  }\n\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    pubkey: pubkey\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function getAllowlistPubKey() {\n        return _getAllowlistPubKey.apply(this, arguments);\n      }\n\n      return getAllowlistPubKey;\n    }()\n  }, {\n    key: \"setAllowlistPubKey\",\n    value: function () {\n      var _setAllowlistPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee8(pk) {\n        return _regenerator.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                return _context8.abrupt(\"return\", this.transport.send(this.cla, INS.ALLOWLIST_SET_PUBKEY, 0, 0, pk).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode)\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function setAllowlistPubKey(_x12) {\n        return _setAllowlistPubKey.apply(this, arguments);\n      }\n\n      return setAllowlistPubKey;\n    }()\n  }, {\n    key: \"getAllowlistHash\",\n    value: function () {\n      var _getAllowlistHash = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee9() {\n        return _regenerator.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                return _context9.abrupt(\"return\", this.transport.send(this.cla, INS.ALLOWLIST_GET_HASH, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  console.log(response);\n                  var hash = response.slice(0, 32); // 32 bytes + 2 error code\n                  // 32 bytes + 2 error code\n\n                  if (response.length !== 34) {\n                    return {\n                      return_code: 0x6984,\n                      error_message: (0, _common.errorCodeToString)(0x6984)\n                    };\n                  }\n\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    hash: hash\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function getAllowlistHash() {\n        return _getAllowlistHash.apply(this, arguments);\n      }\n\n      return getAllowlistHash;\n    }()\n  }, {\n    key: \"uploadSendChunk\",\n    value: function () {\n      var _uploadSendChunk = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee10(chunkIdx, chunkNum, chunk) {\n        var payloadType;\n        return _regenerator.default.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                payloadType = _common.PAYLOAD_TYPE.ADD;\n\n                if (chunkIdx === 1) {\n                  payloadType = _common.PAYLOAD_TYPE.INIT;\n                }\n\n                if (chunkIdx === chunkNum) {\n                  payloadType = _common.PAYLOAD_TYPE.LAST;\n                }\n\n                return _context10.abrupt(\"return\", this.transport.send(this.cla, INS.ALLOWLIST_UPLOAD, payloadType, 0, chunk, [_common.ERROR_CODE.NoError]).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var errorMessage = (0, _common.errorCodeToString)(returnCode);\n                  return {\n                    return_code: returnCode,\n                    error_message: errorMessage\n                  };\n                }, _common.processErrorResponse));\n\n              case 4:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function uploadSendChunk(_x13, _x14, _x15) {\n        return _uploadSendChunk.apply(this, arguments);\n      }\n\n      return uploadSendChunk;\n    }()\n  }, {\n    key: \"uploadAllowlist\",\n    value: function () {\n      var _uploadAllowlist = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee12(message) {\n        var _this2 = this;\n\n        var chunks;\n        return _regenerator.default.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                chunks = [];\n                chunks.push(Buffer.from([0]));\n                chunks.push.apply(chunks, (0, _toConsumableArray2.default)(SubstrateApp.GetChunks(message)));\n                return _context12.abrupt(\"return\", this.uploadSendChunk(1, chunks.length, chunks[0]).then( /*#__PURE__*/function () {\n                  var _ref2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee11(result) {\n                    var i;\n                    return _regenerator.default.wrap(function _callee11$(_context11) {\n                      while (1) {\n                        switch (_context11.prev = _context11.next) {\n                          case 0:\n                            if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                              _context11.next = 2;\n                              break;\n                            }\n\n                            return _context11.abrupt(\"return\", {\n                              return_code: result.return_code,\n                              error_message: result.error_message\n                            });\n\n                          case 2:\n                            i = 1;\n\n                          case 3:\n                            if (!(i < chunks.length)) {\n                              _context11.next = 12;\n                              break;\n                            }\n\n                            _context11.next = 6;\n                            return _this2.uploadSendChunk(1 + i, chunks.length, chunks[i]);\n\n                          case 6:\n                            result = _context11.sent;\n\n                            if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                              _context11.next = 9;\n                              break;\n                            }\n\n                            return _context11.abrupt(\"break\", 12);\n\n                          case 9:\n                            i += 1;\n                            _context11.next = 3;\n                            break;\n\n                          case 12:\n                            return _context11.abrupt(\"return\", {\n                              return_code: result.return_code,\n                              error_message: result.error_message\n                            });\n\n                          case 13:\n                          case \"end\":\n                            return _context11.stop();\n                        }\n                      }\n                    }, _callee11);\n                  }));\n\n                  return function (_x17) {\n                    return _ref2.apply(this, arguments);\n                  };\n                }(), _common.processErrorResponse));\n\n              case 4:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function uploadAllowlist(_x16) {\n        return _uploadAllowlist.apply(this, arguments);\n      }\n\n      return uploadAllowlist;\n    }()\n  }], [{\n    key: \"serializePath\",\n    value: function serializePath(slip0044, account, change, addressIndex) {\n      if (!Number.isInteger(account)) throw new Error('Input must be an integer');\n      if (!Number.isInteger(change)) throw new Error('Input must be an integer');\n      if (!Number.isInteger(addressIndex)) throw new Error('Input must be an integer');\n      var buf = Buffer.alloc(20);\n      buf.writeUInt32LE(0x8000002c, 0);\n      buf.writeUInt32LE(slip0044, 4);\n      buf.writeUInt32LE(account, 8);\n      buf.writeUInt32LE(change, 12);\n      buf.writeUInt32LE(addressIndex, 16);\n      return buf;\n    }\n  }, {\n    key: \"GetChunks\",\n    value: function GetChunks(message) {\n      var chunks = [];\n      var buffer = Buffer.from(message);\n\n      for (var i = 0; i < buffer.length; i += _common.CHUNK_SIZE) {\n        var end = i + _common.CHUNK_SIZE;\n\n        if (i > buffer.length) {\n          end = buffer.length;\n        }\n\n        chunks.push(buffer.slice(i, end));\n      }\n\n      return chunks;\n    }\n  }, {\n    key: \"signGetChunks\",\n    value: function signGetChunks(slip0044, account, change, addressIndex, message) {\n      var chunks = [];\n      var bip44Path = SubstrateApp.serializePath(slip0044, account, change, addressIndex);\n      chunks.push(bip44Path);\n      chunks.push.apply(chunks, (0, _toConsumableArray2.default)(SubstrateApp.GetChunks(message)));\n      return chunks;\n    }\n  }]);\n  return SubstrateApp;\n}();\n\nfunction newKusamaApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.KUSAMA, _config.SLIP0044.KUSAMA);\n}\n\nfunction newPolkadotApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.POLKADOT, _config.SLIP0044.POLKADOT);\n}\n\nfunction newPolymeshApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.POLYMESH, _config.SLIP0044.POLYMESH);\n}\n\nfunction newDockApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.DOCK, _config.SLIP0044.DOCK);\n}\n\nfunction newCentrifugeApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.CENTRIFUGE, _config.SLIP0044.CENTRIFUGE);\n}\n\nfunction newEdgewareApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.EDGEWARE, _config.SLIP0044.EDGEWARE);\n}\n\nfunction newEquilibriumApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.EQUILIBRIUM, _config.SLIP0044.EQUILIBRIUM);\n}\n\nfunction newGenshiroApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.GENSHIRO, _config.SLIP0044.GENSHIRO);\n}\n\nfunction newStatemintApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.STATEMINT, _config.SLIP0044.STATEMINT);\n}\n\nfunction newStatemineApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.STATEMINE, _config.SLIP0044.STATEMINE);\n}\n\nfunction newNodleApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.NODLE, _config.SLIP0044.NODLE);\n}\n\nfunction newSoraApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.SORA, _config.SLIP0044.SORA);\n}\n\nfunction sha512(data) {\n  var digest = hash.sha512().update(data).digest();\n  return Buffer.from(digest);\n}\n\nfunction hmac256(key, data) {\n  var digest = hash.hmac(hash.sha256, key).update(data).digest();\n  return Buffer.from(digest);\n}\n\nfunction hmac512(key, data) {\n  var digest = hash.hmac(hash.sha512, key).update(data).digest();\n  return Buffer.from(digest);\n}\n\nfunction ss58hash(data) {\n  var hash = blake.blake2bInit(64, null);\n  blake.blake2bUpdate(hash, Buffer.from('SS58PRE'));\n  blake.blake2bUpdate(hash, data);\n  return blake.blake2bFinal(hash);\n}\n\nfunction ss58_encode(prefix, pubkey) {\n  if (pubkey.byteLength !== 32) {\n    return null;\n  }\n\n  var data = Buffer.alloc(35);\n  data[0] = prefix;\n  pubkey.copy(data, 1);\n  var hash = ss58hash(data.slice(0, 33));\n  data[33] = hash[0];\n  data[34] = hash[1];\n  return bs58.encode(data);\n}\n\nfunction root_node_slip10(master_seed) {\n  var data = Buffer.alloc(1 + 64);\n  data[0] = 0x01;\n  master_seed.copy(data, 1);\n  var c = hmac256('ed25519 seed', data);\n  var I = hmac512('ed25519 seed', data.slice(1));\n  var kL = I.slice(0, 32);\n  var kR = I.slice(32);\n\n  while ((kL[31] & 32) !== 0) {\n    I.copy(data, 1);\n    I = hmac512('ed25519 seed', data.slice(1));\n    kL = I.slice(0, 32);\n    kR = I.slice(32);\n  }\n\n  kL[0] &= 248;\n  kL[31] &= 127;\n  kL[31] |= 64;\n  return Buffer.concat([kL, kR, c]);\n}\n\nfunction hdKeyDerivation(mnemonic, password, slip0044, accountIndex, changeIndex, addressIndex, ss58prefix) {\n  if (!bip39.validateMnemonic(mnemonic)) {\n    console.log('Invalid mnemonic');\n    return null;\n  }\n\n  var seed = bip39.mnemonicToSeedSync(mnemonic, password);\n  var node = root_node_slip10(seed);\n  node = bip32ed25519.derivePrivate(node, HDPATH_0_DEFAULT);\n  node = bip32ed25519.derivePrivate(node, slip0044);\n  node = bip32ed25519.derivePrivate(node, accountIndex);\n  node = bip32ed25519.derivePrivate(node, changeIndex);\n  node = bip32ed25519.derivePrivate(node, addressIndex);\n  var kL = node.slice(0, 32);\n  var sk = sha512(kL).slice(0, 32);\n  sk[0] &= 248;\n  sk[31] &= 127;\n  sk[31] |= 64;\n  var pk = bip32ed25519.toPublic(sk);\n  var address = ss58_encode(ss58prefix, pk);\n  return {\n    sk: kL,\n    pk: pk,\n    address: address\n  };\n}\n\nmodule.exports = {\n  hdKeyDerivation: hdKeyDerivation,\n  newKusamaApp: newKusamaApp,\n  newPolkadotApp: newPolkadotApp,\n  newPolymeshApp: newPolymeshApp,\n  newDockApp: newDockApp,\n  newCentrifugeApp: newCentrifugeApp,\n  newEdgewareApp: newEdgewareApp,\n  newEquilibriumApp: newEquilibriumApp,\n  newGenshiroApp: newGenshiroApp,\n  newStatemintApp: newStatemintApp,\n  newStatemineApp: newStatemineApp,\n  newNodleApp: newNodleApp,\n  newSoraApp: newSoraApp\n};","map":{"version":3,"sources":["/home/arieiro/rust/Flora.Network/flora-front/node_modules/@zondax/ledger-substrate/dist/index.js"],"names":["_interopRequireDefault","require","_regenerator","_toConsumableArray2","_asyncToGenerator2","_classCallCheck2","_createClass2","_common","_config","bip39","hash","bip32ed25519","bs58","blake","HDPATH_0_DEFAULT","INS","GET_VERSION","GET_ADDR","SIGN","ALLOWLIST_GET_PUBKEY","ALLOWLIST_SET_PUBKEY","ALLOWLIST_GET_HASH","ALLOWLIST_UPLOAD","SubstrateApp","transport","cla","slip0044","default","Error","key","value","_getVersion2","mark","_callee","wrap","_callee$","_context","prev","next","getVersion","abrupt","sent","t0","processErrorResponse","stop","apply","arguments","_appInfo","_callee2","_callee2$","_context2","send","then","response","errorCodeData","slice","returnCode","result","appName","appVersion","flagLen","flagsValue","error_message","return_code","appNameLen","toString","idx","appVersionLen","appFlagsLen","errorCodeToString","flag_recovery","flag_signed_mcu_code","flag_onboarded","flag_pin_validated","appInfo","_getAddress","_callee3","account","change","addressIndex","requireConfirmation","scheme","bip44Path","p1","p2","_args3","_callee3$","_context3","length","undefined","SCHEME","ED25519","serializePath","isNaN","errorCode","pubKey","address","getAddress","_x","_x2","_x3","_signSendChunk","_callee4","chunkIdx","chunkNum","chunk","payloadType","_args4","_callee4$","_context4","PAYLOAD_TYPE","ADD","INIT","LAST","ERROR_CODE","NoError","errorMessage","signature","signSendChunk","_x4","_x5","_x6","_sign","_callee6","message","_this","chunks","_args6","_callee6$","_context6","signGetChunks","_ref","_callee5","i","_callee5$","_context5","_x11","sign","_x7","_x8","_x9","_x10","_getAllowlistPubKey","_callee7","_callee7$","_context7","console","log","pubkey","getAllowlistPubKey","_setAllowlistPubKey","_callee8","pk","_callee8$","_context8","setAllowlistPubKey","_x12","_getAllowlistHash","_callee9","_callee9$","_context9","getAllowlistHash","_uploadSendChunk","_callee10","_callee10$","_context10","uploadSendChunk","_x13","_x14","_x15","_uploadAllowlist","_callee12","_this2","_callee12$","_context12","push","Buffer","from","GetChunks","_ref2","_callee11","_callee11$","_context11","_x17","uploadAllowlist","_x16","Number","isInteger","buf","alloc","writeUInt32LE","buffer","CHUNK_SIZE","end","newKusamaApp","CLA","KUSAMA","SLIP0044","newPolkadotApp","POLKADOT","newPolymeshApp","POLYMESH","newDockApp","DOCK","newCentrifugeApp","CENTRIFUGE","newEdgewareApp","EDGEWARE","newEquilibriumApp","EQUILIBRIUM","newGenshiroApp","GENSHIRO","newStatemintApp","STATEMINT","newStatemineApp","STATEMINE","newNodleApp","NODLE","newSoraApp","SORA","sha512","data","digest","update","hmac256","hmac","sha256","hmac512","ss58hash","blake2bInit","blake2bUpdate","blake2bFinal","ss58_encode","prefix","byteLength","copy","encode","root_node_slip10","master_seed","c","I","kL","kR","concat","hdKeyDerivation","mnemonic","password","accountIndex","changeIndex","ss58prefix","validateMnemonic","seed","mnemonicToSeedSync","node","derivePrivate","sk","toPublic","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _common = require(\"./common\");\n\nvar _config = require(\"./config\");\n\n/** ******************************************************************************\n *  (c) 2019 ZondaX GmbH\n *  (c) 2016-2017 Ledger\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n ******************************************************************************* */\nvar bip39 = require('bip39');\n\nvar hash = require('hash.js');\n\nvar bip32ed25519 = require('bip32-ed25519');\n\nvar bs58 = require('bs58');\n\nvar blake = require('blakejs');\n\nvar HDPATH_0_DEFAULT = 0x8000002c;\nvar INS = {\n  GET_VERSION: 0x00,\n  GET_ADDR: 0x01,\n  SIGN: 0x02,\n  // Allow list related commands\n  ALLOWLIST_GET_PUBKEY: 0x90,\n  ALLOWLIST_SET_PUBKEY: 0x91,\n  ALLOWLIST_GET_HASH: 0x92,\n  ALLOWLIST_UPLOAD: 0x93\n};\n\nvar SubstrateApp = /*#__PURE__*/function () {\n  function SubstrateApp(transport, cla, slip0044) {\n    (0, _classCallCheck2.default)(this, SubstrateApp);\n\n    if (!transport) {\n      throw new Error('Transport has not been defined');\n    }\n\n    this.transport = transport;\n    this.cla = cla;\n    this.slip0044 = slip0044;\n  }\n\n  (0, _createClass2.default)(SubstrateApp, [{\n    key: \"getVersion\",\n    value: function () {\n      var _getVersion2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {\n        return _regenerator.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return (0, _common.getVersion)(this.transport, this.cla);\n\n              case 3:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 6:\n                _context.prev = 6;\n                _context.t0 = _context[\"catch\"](0);\n                return _context.abrupt(\"return\", (0, _common.processErrorResponse)(_context.t0));\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 6]]);\n      }));\n\n      function getVersion() {\n        return _getVersion2.apply(this, arguments);\n      }\n\n      return getVersion;\n    }()\n  }, {\n    key: \"appInfo\",\n    value: function () {\n      var _appInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2() {\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", this.transport.send(0xb0, 0x01, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var result = {};\n                  var appName = 'err';\n                  var appVersion = 'err';\n                  var flagLen = 0;\n                  var flagsValue = 0;\n\n                  if (response[0] !== 1) {\n                    // Ledger responds with format ID 1. There is no spec for any format != 1\n                    result.error_message = 'response format ID not recognized';\n                    result.return_code = 0x9001;\n                  } else {\n                    var appNameLen = response[1];\n                    appName = response.slice(2, 2 + appNameLen).toString('ascii');\n                    var idx = 2 + appNameLen;\n                    var appVersionLen = response[idx];\n                    idx += 1;\n                    appVersion = response.slice(idx, idx + appVersionLen).toString('ascii');\n                    idx += appVersionLen;\n                    var appFlagsLen = response[idx];\n                    idx += 1;\n                    flagLen = appFlagsLen;\n                    flagsValue = response[idx];\n                  }\n\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    appName: appName,\n                    appVersion: appVersion,\n                    flagLen: flagLen,\n                    flagsValue: flagsValue,\n                    // eslint-disable-next-line no-bitwise\n                    flag_recovery: (flagsValue & 1) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_signed_mcu_code: (flagsValue & 2) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_onboarded: (flagsValue & 4) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_pin_validated: (flagsValue & 128) !== 0\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function appInfo() {\n        return _appInfo.apply(this, arguments);\n      }\n\n      return appInfo;\n    }()\n  }, {\n    key: \"getAddress\",\n    value: function () {\n      var _getAddress = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3(account, change, addressIndex) {\n        var requireConfirmation,\n            scheme,\n            bip44Path,\n            p1,\n            p2,\n            _args3 = arguments;\n        return _regenerator.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                requireConfirmation = _args3.length > 3 && _args3[3] !== undefined ? _args3[3] : false;\n                scheme = _args3.length > 4 && _args3[4] !== undefined ? _args3[4] : _common.SCHEME.ED25519;\n                bip44Path = SubstrateApp.serializePath(this.slip0044, account, change, addressIndex);\n                p1 = 0;\n                if (requireConfirmation) p1 = 1;\n                p2 = 0;\n                if (!isNaN(scheme)) p2 = scheme;\n                return _context3.abrupt(\"return\", this.transport.send(this.cla, INS.GET_ADDR, p1, p2, bip44Path).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var errorCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  return {\n                    pubKey: response.slice(0, 32).toString('hex'),\n                    address: response.slice(32, response.length - 2).toString('ascii'),\n                    return_code: errorCode,\n                    error_message: (0, _common.errorCodeToString)(errorCode)\n                  };\n                }, _common.processErrorResponse));\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getAddress(_x, _x2, _x3) {\n        return _getAddress.apply(this, arguments);\n      }\n\n      return getAddress;\n    }()\n  }, {\n    key: \"signSendChunk\",\n    value: function () {\n      var _signSendChunk = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4(chunkIdx, chunkNum, chunk) {\n        var scheme,\n            payloadType,\n            p2,\n            _args4 = arguments;\n        return _regenerator.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                scheme = _args4.length > 3 && _args4[3] !== undefined ? _args4[3] : _common.SCHEME.ED25519;\n                payloadType = _common.PAYLOAD_TYPE.ADD;\n\n                if (chunkIdx === 1) {\n                  payloadType = _common.PAYLOAD_TYPE.INIT;\n                }\n\n                if (chunkIdx === chunkNum) {\n                  payloadType = _common.PAYLOAD_TYPE.LAST;\n                }\n\n                p2 = 0;\n                if (!isNaN(scheme)) p2 = scheme;\n                return _context4.abrupt(\"return\", this.transport.send(this.cla, INS.SIGN, payloadType, p2, chunk, [_common.ERROR_CODE.NoError, 0x6984, 0x6a80]).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var errorMessage = (0, _common.errorCodeToString)(returnCode);\n                  var signature = null;\n\n                  if (returnCode === 0x6a80 || returnCode === 0x6984) {\n                    errorMessage = response.slice(0, response.length - 2).toString('ascii');\n                  } else if (response.length > 2) {\n                    signature = response.slice(0, response.length - 2);\n                  }\n\n                  return {\n                    signature: signature,\n                    return_code: returnCode,\n                    error_message: errorMessage\n                  };\n                }, _common.processErrorResponse));\n\n              case 7:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function signSendChunk(_x4, _x5, _x6) {\n        return _signSendChunk.apply(this, arguments);\n      }\n\n      return signSendChunk;\n    }()\n  }, {\n    key: \"sign\",\n    value: function () {\n      var _sign = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6(account, change, addressIndex, message) {\n        var _this = this;\n\n        var scheme,\n            chunks,\n            _args6 = arguments;\n        return _regenerator.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                scheme = _args6.length > 4 && _args6[4] !== undefined ? _args6[4] : _common.SCHEME.ED25519;\n                chunks = SubstrateApp.signGetChunks(this.slip0044, account, change, addressIndex, message);\n                return _context6.abrupt(\"return\", this.signSendChunk(1, chunks.length, chunks[0], scheme).then( /*#__PURE__*/function () {\n                  var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5(result) {\n                    var i;\n                    return _regenerator.default.wrap(function _callee5$(_context5) {\n                      while (1) {\n                        switch (_context5.prev = _context5.next) {\n                          case 0:\n                            i = 1;\n\n                          case 1:\n                            if (!(i < chunks.length)) {\n                              _context5.next = 10;\n                              break;\n                            }\n\n                            _context5.next = 4;\n                            return _this.signSendChunk(1 + i, chunks.length, chunks[i], scheme);\n\n                          case 4:\n                            result = _context5.sent;\n\n                            if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                              _context5.next = 7;\n                              break;\n                            }\n\n                            return _context5.abrupt(\"break\", 10);\n\n                          case 7:\n                            i += 1;\n                            _context5.next = 1;\n                            break;\n\n                          case 10:\n                            return _context5.abrupt(\"return\", {\n                              return_code: result.return_code,\n                              error_message: result.error_message,\n                              signature: result.signature\n                            });\n\n                          case 11:\n                          case \"end\":\n                            return _context5.stop();\n                        }\n                      }\n                    }, _callee5);\n                  }));\n\n                  return function (_x11) {\n                    return _ref.apply(this, arguments);\n                  };\n                }(), _common.processErrorResponse));\n\n              case 3:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function sign(_x7, _x8, _x9, _x10) {\n        return _sign.apply(this, arguments);\n      }\n\n      return sign;\n    }() /// Allow list related commands. They are NOT available on all apps\n\n  }, {\n    key: \"getAllowlistPubKey\",\n    value: function () {\n      var _getAllowlistPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee7() {\n        return _regenerator.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                return _context7.abrupt(\"return\", this.transport.send(this.cla, INS.ALLOWLIST_GET_PUBKEY, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  console.log(response);\n                  var pubkey = response.slice(0, 32); // 32 bytes + 2 error code\n\n                  // 32 bytes + 2 error code\n                  if (response.length !== 34) {\n                    return {\n                      return_code: 0x6984,\n                      error_message: (0, _common.errorCodeToString)(0x6984)\n                    };\n                  }\n\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    pubkey: pubkey\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function getAllowlistPubKey() {\n        return _getAllowlistPubKey.apply(this, arguments);\n      }\n\n      return getAllowlistPubKey;\n    }()\n  }, {\n    key: \"setAllowlistPubKey\",\n    value: function () {\n      var _setAllowlistPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee8(pk) {\n        return _regenerator.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                return _context8.abrupt(\"return\", this.transport.send(this.cla, INS.ALLOWLIST_SET_PUBKEY, 0, 0, pk).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode)\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function setAllowlistPubKey(_x12) {\n        return _setAllowlistPubKey.apply(this, arguments);\n      }\n\n      return setAllowlistPubKey;\n    }()\n  }, {\n    key: \"getAllowlistHash\",\n    value: function () {\n      var _getAllowlistHash = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee9() {\n        return _regenerator.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                return _context9.abrupt(\"return\", this.transport.send(this.cla, INS.ALLOWLIST_GET_HASH, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  console.log(response);\n                  var hash = response.slice(0, 32); // 32 bytes + 2 error code\n\n                  // 32 bytes + 2 error code\n                  if (response.length !== 34) {\n                    return {\n                      return_code: 0x6984,\n                      error_message: (0, _common.errorCodeToString)(0x6984)\n                    };\n                  }\n\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    hash: hash\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function getAllowlistHash() {\n        return _getAllowlistHash.apply(this, arguments);\n      }\n\n      return getAllowlistHash;\n    }()\n  }, {\n    key: \"uploadSendChunk\",\n    value: function () {\n      var _uploadSendChunk = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee10(chunkIdx, chunkNum, chunk) {\n        var payloadType;\n        return _regenerator.default.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                payloadType = _common.PAYLOAD_TYPE.ADD;\n\n                if (chunkIdx === 1) {\n                  payloadType = _common.PAYLOAD_TYPE.INIT;\n                }\n\n                if (chunkIdx === chunkNum) {\n                  payloadType = _common.PAYLOAD_TYPE.LAST;\n                }\n\n                return _context10.abrupt(\"return\", this.transport.send(this.cla, INS.ALLOWLIST_UPLOAD, payloadType, 0, chunk, [_common.ERROR_CODE.NoError]).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var errorMessage = (0, _common.errorCodeToString)(returnCode);\n                  return {\n                    return_code: returnCode,\n                    error_message: errorMessage\n                  };\n                }, _common.processErrorResponse));\n\n              case 4:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function uploadSendChunk(_x13, _x14, _x15) {\n        return _uploadSendChunk.apply(this, arguments);\n      }\n\n      return uploadSendChunk;\n    }()\n  }, {\n    key: \"uploadAllowlist\",\n    value: function () {\n      var _uploadAllowlist = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee12(message) {\n        var _this2 = this;\n\n        var chunks;\n        return _regenerator.default.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                chunks = [];\n                chunks.push(Buffer.from([0]));\n                chunks.push.apply(chunks, (0, _toConsumableArray2.default)(SubstrateApp.GetChunks(message)));\n                return _context12.abrupt(\"return\", this.uploadSendChunk(1, chunks.length, chunks[0]).then( /*#__PURE__*/function () {\n                  var _ref2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee11(result) {\n                    var i;\n                    return _regenerator.default.wrap(function _callee11$(_context11) {\n                      while (1) {\n                        switch (_context11.prev = _context11.next) {\n                          case 0:\n                            if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                              _context11.next = 2;\n                              break;\n                            }\n\n                            return _context11.abrupt(\"return\", {\n                              return_code: result.return_code,\n                              error_message: result.error_message\n                            });\n\n                          case 2:\n                            i = 1;\n\n                          case 3:\n                            if (!(i < chunks.length)) {\n                              _context11.next = 12;\n                              break;\n                            }\n\n                            _context11.next = 6;\n                            return _this2.uploadSendChunk(1 + i, chunks.length, chunks[i]);\n\n                          case 6:\n                            result = _context11.sent;\n\n                            if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                              _context11.next = 9;\n                              break;\n                            }\n\n                            return _context11.abrupt(\"break\", 12);\n\n                          case 9:\n                            i += 1;\n                            _context11.next = 3;\n                            break;\n\n                          case 12:\n                            return _context11.abrupt(\"return\", {\n                              return_code: result.return_code,\n                              error_message: result.error_message\n                            });\n\n                          case 13:\n                          case \"end\":\n                            return _context11.stop();\n                        }\n                      }\n                    }, _callee11);\n                  }));\n\n                  return function (_x17) {\n                    return _ref2.apply(this, arguments);\n                  };\n                }(), _common.processErrorResponse));\n\n              case 4:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function uploadAllowlist(_x16) {\n        return _uploadAllowlist.apply(this, arguments);\n      }\n\n      return uploadAllowlist;\n    }()\n  }], [{\n    key: \"serializePath\",\n    value: function serializePath(slip0044, account, change, addressIndex) {\n      if (!Number.isInteger(account)) throw new Error('Input must be an integer');\n      if (!Number.isInteger(change)) throw new Error('Input must be an integer');\n      if (!Number.isInteger(addressIndex)) throw new Error('Input must be an integer');\n      var buf = Buffer.alloc(20);\n      buf.writeUInt32LE(0x8000002c, 0);\n      buf.writeUInt32LE(slip0044, 4);\n      buf.writeUInt32LE(account, 8);\n      buf.writeUInt32LE(change, 12);\n      buf.writeUInt32LE(addressIndex, 16);\n      return buf;\n    }\n  }, {\n    key: \"GetChunks\",\n    value: function GetChunks(message) {\n      var chunks = [];\n      var buffer = Buffer.from(message);\n\n      for (var i = 0; i < buffer.length; i += _common.CHUNK_SIZE) {\n        var end = i + _common.CHUNK_SIZE;\n\n        if (i > buffer.length) {\n          end = buffer.length;\n        }\n\n        chunks.push(buffer.slice(i, end));\n      }\n\n      return chunks;\n    }\n  }, {\n    key: \"signGetChunks\",\n    value: function signGetChunks(slip0044, account, change, addressIndex, message) {\n      var chunks = [];\n      var bip44Path = SubstrateApp.serializePath(slip0044, account, change, addressIndex);\n      chunks.push(bip44Path);\n      chunks.push.apply(chunks, (0, _toConsumableArray2.default)(SubstrateApp.GetChunks(message)));\n      return chunks;\n    }\n  }]);\n  return SubstrateApp;\n}();\n\nfunction newKusamaApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.KUSAMA, _config.SLIP0044.KUSAMA);\n}\n\nfunction newPolkadotApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.POLKADOT, _config.SLIP0044.POLKADOT);\n}\n\nfunction newPolymeshApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.POLYMESH, _config.SLIP0044.POLYMESH);\n}\n\nfunction newDockApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.DOCK, _config.SLIP0044.DOCK);\n}\n\nfunction newCentrifugeApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.CENTRIFUGE, _config.SLIP0044.CENTRIFUGE);\n}\n\nfunction newEdgewareApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.EDGEWARE, _config.SLIP0044.EDGEWARE);\n}\n\nfunction newEquilibriumApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.EQUILIBRIUM, _config.SLIP0044.EQUILIBRIUM);\n}\n\nfunction newGenshiroApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.GENSHIRO, _config.SLIP0044.GENSHIRO);\n}\n\nfunction newStatemintApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.STATEMINT, _config.SLIP0044.STATEMINT);\n}\n\nfunction newStatemineApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.STATEMINE, _config.SLIP0044.STATEMINE);\n}\n\nfunction newNodleApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.NODLE, _config.SLIP0044.NODLE);\n}\n\nfunction newSoraApp(transport) {\n  return new SubstrateApp(transport, _config.CLA.SORA, _config.SLIP0044.SORA);\n}\n\nfunction sha512(data) {\n  var digest = hash.sha512().update(data).digest();\n  return Buffer.from(digest);\n}\n\nfunction hmac256(key, data) {\n  var digest = hash.hmac(hash.sha256, key).update(data).digest();\n  return Buffer.from(digest);\n}\n\nfunction hmac512(key, data) {\n  var digest = hash.hmac(hash.sha512, key).update(data).digest();\n  return Buffer.from(digest);\n}\n\nfunction ss58hash(data) {\n  var hash = blake.blake2bInit(64, null);\n  blake.blake2bUpdate(hash, Buffer.from('SS58PRE'));\n  blake.blake2bUpdate(hash, data);\n  return blake.blake2bFinal(hash);\n}\n\nfunction ss58_encode(prefix, pubkey) {\n  if (pubkey.byteLength !== 32) {\n    return null;\n  }\n\n  var data = Buffer.alloc(35);\n  data[0] = prefix;\n  pubkey.copy(data, 1);\n  var hash = ss58hash(data.slice(0, 33));\n  data[33] = hash[0];\n  data[34] = hash[1];\n  return bs58.encode(data);\n}\n\nfunction root_node_slip10(master_seed) {\n  var data = Buffer.alloc(1 + 64);\n  data[0] = 0x01;\n  master_seed.copy(data, 1);\n  var c = hmac256('ed25519 seed', data);\n  var I = hmac512('ed25519 seed', data.slice(1));\n  var kL = I.slice(0, 32);\n  var kR = I.slice(32);\n\n  while ((kL[31] & 32) !== 0) {\n    I.copy(data, 1);\n    I = hmac512('ed25519 seed', data.slice(1));\n    kL = I.slice(0, 32);\n    kR = I.slice(32);\n  }\n\n  kL[0] &= 248;\n  kL[31] &= 127;\n  kL[31] |= 64;\n  return Buffer.concat([kL, kR, c]);\n}\n\nfunction hdKeyDerivation(mnemonic, password, slip0044, accountIndex, changeIndex, addressIndex, ss58prefix) {\n  if (!bip39.validateMnemonic(mnemonic)) {\n    console.log('Invalid mnemonic');\n    return null;\n  }\n\n  var seed = bip39.mnemonicToSeedSync(mnemonic, password);\n  var node = root_node_slip10(seed);\n  node = bip32ed25519.derivePrivate(node, HDPATH_0_DEFAULT);\n  node = bip32ed25519.derivePrivate(node, slip0044);\n  node = bip32ed25519.derivePrivate(node, accountIndex);\n  node = bip32ed25519.derivePrivate(node, changeIndex);\n  node = bip32ed25519.derivePrivate(node, addressIndex);\n  var kL = node.slice(0, 32);\n  var sk = sha512(kL).slice(0, 32);\n  sk[0] &= 248;\n  sk[31] &= 127;\n  sk[31] |= 64;\n  var pk = bip32ed25519.toPublic(sk);\n  var address = ss58_encode(ss58prefix, pk);\n  return {\n    sk: kL,\n    pk: pk,\n    address: address\n  };\n}\n\nmodule.exports = {\n  hdKeyDerivation: hdKeyDerivation,\n  newKusamaApp: newKusamaApp,\n  newPolkadotApp: newPolkadotApp,\n  newPolymeshApp: newPolymeshApp,\n  newDockApp: newDockApp,\n  newCentrifugeApp: newCentrifugeApp,\n  newEdgewareApp: newEdgewareApp,\n  newEquilibriumApp: newEquilibriumApp,\n  newGenshiroApp: newGenshiroApp,\n  newStatemintApp: newStatemintApp,\n  newStatemineApp: newStatemineApp,\n  newNodleApp: newNodleApp,\n  newSoraApp: newSoraApp\n};"]},"metadata":{},"sourceType":"script"}